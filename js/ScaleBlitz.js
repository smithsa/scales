var ScalePlayer=require("./ScalePlayer"),Scale=require("./Scale"),ScaleBlitz=function(){var e=null,t=null,n=null,a=null,c=null,l=null,u=null,i=0,r=["A","B","C","D","E","F","G"];function o(e, t, n){var r,s,h,$,m,f;function v(e){return e<=9?"0"+e:e}r=document.getElementById(e),s=+new Date+1e3*(60*t+n)+500,function d(){if((m=s-+new Date)<1e3){r.innerHTML="Time Up!";var g=Scale.getScale(l,u);1==i?ScalePlayer.arpeggiate(g,!0):ScalePlayer.arpeggiate(g);var S=1e3*ScalePlayer.getScaleDuration();console.log(ScalePlayer.getScaleDuration()),c=setTimeout((function(){p(),setTimeout(o(e,t,n),2e3)}),S)}else f=new Date(m),h=f.getUTCHours(),$=f.getUTCMinutes(),r.innerHTML=(h?h+":"+v($):$)+":"+v(f.getUTCSeconds()),a=setTimeout(d,f.getUTCMilliseconds()+500)}()}function s(e, t){return Math.floor(Math.random()*(t-e+1)+e)}function p(){var n=r[s(0,r.length-1)],a=e[s(0,e.length-1)],c=(s(1,6),function(e, t){var n=e,a="";"B"===t||"E"===t?a="sharps":"C"!==t&&"F"!==t||(a="flats");var c=n.indexOf(a);return c>=0&&n.splice(c,1),n}(t,n)),i=c[s(0,t.length-1)];"flats"===i?n+=" Flat":"naturals"===i?n=n:"sharps"===i&&(n+="#"),$("#key").text(n),$("#scale").text(a),l=function(e){e=e.replace(" Flat","b");var t={"A#":"Bb",Db:"C#","D#":"Eb",Gb:"F#",Ab:"G#"};return t.hasOwnProperty(e)&&(e=t[e]),e}(n),u=a}return{init:function(){$("#bpm").select2(),$("#start").click((function(){n=parseInt($("#seconds").val()),t=function(){var e=[];return $("input.input-keys").each((function(){$(this).is(":checked")&&e.push($(this).val())})),e}(),e=function(){var e=[];return $("input.input-scales").each((function(){$(this).is(":checked")&&e.push($(this).val())})),e}(),s(1,6),p(),$("#start").hide(),$("#stop").show(),$("#count").show(),$(".controls h3").show(),o("count",0,n)})),$("#stop, #c-button--slide-right").click((function(){clearTimeout(a),$("#key").text("Key"),$("#scale").text("Scale"),$("#count").hide(),$("#stop").hide(),$("#start").show(),clearTimeout(c),ScalePlayer.stop()})),$(".input-number-decrement").click((function(){var e=parseInt($(".input-number").val());e>0&&$(".input-number").val(e-1)})),$(".input-number-increment").click((function(){var e=parseInt($(".input-number").val());e<120&&$(".input-number").val(e+1)})),$("input[name='octave_num']").click((function(){i=parseInt($("input[name='octave_num']:checked").val())})),$("#bpm").change((function(){ScalePlayer.changeTempo($(this).val())})),document.addEventListener("mousedown",(function(){"running"!==Tone.context.state&&Tone.context.resume()}),{once:!0})}}}();module.exports=ScaleBlitz;
